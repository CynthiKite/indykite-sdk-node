// Copyright (c) 2020 IndyKite
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package indykite.config.v1beta1;

option csharp_namespace = "Id.Indykite.Jarvis.Services.Configuration";
option go_package = "github.com/indykite/jarvis/pkg/proto-gen/config/v1;config";
option java_multiple_files = true;
option java_outer_classname = "ModelProto";
option java_package = "com.id.indykite.jarvis.services.configuration";
option objc_class_prefix = "IIJSC";
option php_namespace = "Id\\Indykite\\Jarvis\\Services\\Configuration";

import "google/protobuf/any.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";
import "indykite/objects/v1beta1/struct.proto";
import "validate/validate.proto";

// UniqueNameIdentifier is an alternative to Globally Unique ID generated by the server.
//
// This identifier combines the Globally Unique ID of the location where to look for the name
// to find the object. It makes the object identification easier by the human readable name.
message UniqueNameIdentifier {
  string location = 1 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // Name is unique name of configuration object.
  string name = 2 [(validate.rules).string = {
    min_len: 2,
    max_len: 254
    pattern: "^[a-z](?:[-a-z0-9]{0,252}[a-z0-9])$"
  }];
}

// Customer representing the Customer Node.
message Customer {
  // Globally unique identifier.
  string id = 1 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // Name is unique name of configuration object.
  string name = 2 [(validate.rules).string = {
    min_len: 2,
    max_len: 63
    pattern: "^[a-z](?:[-a-z0-9]{0,61}[a-z0-9])$"
  }];
  // Human readable name of configuration.
  string display_name = 3 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Description of the configuration
  google.protobuf.StringValue description = 4 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Output only. The time at which the configuration was created.
  google.protobuf.Timestamp create_time = 5;
  // Output only. The time at which the configuration was last changed.
  //
  // This value is initially set to the `create_time` then increases monotonically with each change.
  google.protobuf.Timestamp update_time = 6;
  // Output only. The time this configuration was destroyed.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp destroy_time = 7;
  // Output only. The time this configuration will be entirely deleted.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp delete_time = 8;
  // Output only. Multiversion concurrency control version.
  string etag = 9;
}

// ApplicationSpace representing the Application Space Node.
message ApplicationSpace {
  // Globally unique identifier.
  string id = 1 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // Name is unique name of configuration object.
  string name = 2 [(validate.rules).string = {
    min_len: 2,
    max_len: 63
    pattern: "^[a-z](?:[-a-z0-9]{0,61}[a-z0-9])$"
  }];
  // Human readable name of configuration.
  string display_name = 3 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Description of the configuration
  google.protobuf.StringValue description = 4 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Output only. The time at which the configuration was created.
  google.protobuf.Timestamp create_time = 5;
  // Output only. The time at which the configuration was last changed.
  //
  // This value is initially set to the `create_time` then increases monotonically with each change.
  google.protobuf.Timestamp update_time = 6;
  // Output only. The time this configuration was destroyed.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp destroy_time = 7;
  // Output only. The time this configuration will be entirely deleted.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp delete_time = 8;
  // Output only. Multiversion concurrency control version.
  string etag = 9;
  // CustomerId this object is directly or indirectly connected to.
  string customer_id = 10 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // IssuerId associated with this Application Space.
  string issuer_id = 11 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
}

// Tenant is a representation of an organization.
// Tenant is distinct and separate from other IndyKite tenants and has its own
// representation of objects.
message Tenant {
  // Globally unique identifier.
  string id = 1 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // Name is unique name of configuration object.
  string name = 2 [(validate.rules).string = {
    min_len: 2,
    max_len: 63
    pattern: "^[a-z](?:[-a-z0-9]{0,61}[a-z0-9])$"
  }];
  // Human readable name of configuration.
  string display_name = 3 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Description of the configuration
  google.protobuf.StringValue description = 4 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Output only. The time at which the configuration was created.
  google.protobuf.Timestamp create_time = 5;
  // Output only. The time at which the configuration was last changed.
  //
  // This value is initially set to the `create_time` then increases monotonically with each change.
  google.protobuf.Timestamp update_time = 6;
  // Output only. The time this configuration was destroyed.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp destroy_time = 7;
  // Output only. The time this configuration will be entirely deleted.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp delete_time = 8;
  // Output only. Multiversion concurrency control version.
  string etag = 9;
  // CustomerId this object is directly or indirectly connected to.
  string customer_id = 10 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // AppSpaceId this object is directly or indirectly connected to.
  string app_space_id = 11 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // IssuerId this object is directly or indirectly connected to.
  string issuer_id = 12 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
}

//// Issuer represents an Identity Provider of a Tenant.
//message Issuer {
//  //Globally unique identifier.
//  bytes id = 1;
//  //  //The Parent Tenant ID.
//  //  string tenant_id = 2;
//  //Unique name of tenant. It's not globally unique only unique in scope of subscription.
//  //The name value is immutable.
//  string name = 3;
//  //Human readable name of tenant.
//  string display_name = 4;
//}

// Application represents the customer application.
message Application {
  // Globally unique identifier.
  string id = 1 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // Name is unique name of configuration object.
  string name = 2 [(validate.rules).string = {
    min_len: 2,
    max_len: 63
    pattern: "^[a-z](?:[-a-z0-9]{0,61}[a-z0-9])$"
  }];
  // Human readable name of configuration.
  string display_name = 3 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Description of the configuration
  google.protobuf.StringValue description = 4 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Output only. The time at which the configuration was created.
  google.protobuf.Timestamp create_time = 5;
  // Output only. The time at which the configuration was last changed.
  //
  // This value is initially set to the `create_time` then increases monotonically with each change.
  google.protobuf.Timestamp update_time = 6;
  // Output only. The time this configuration was destroyed.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp destroy_time = 7;
  // Output only. The time this configuration will be entirely deleted.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp delete_time = 8;
  // Output only. Multiversion concurrency control version.
  string etag = 9;
  // CustomerId this object is directly or indirectly connected to.
  string customer_id = 10 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // AppSpaceId this object is directly or indirectly connected to.
  string app_space_id = 11 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
}

message ApplicationAgent {
  // Globally unique identifier.
  string id = 1 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // Name is unique name of configuration object.
  string name = 2 [(validate.rules).string = {
    min_len: 2,
    max_len: 254
    pattern: "^[a-z](?:[-a-z0-9]{0,252}[a-z0-9])$"
  }];
  // Human readable name of configuration.
  string display_name = 3 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Description of the configuration
  google.protobuf.StringValue description = 4 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Output only. The time at which the configuration was created.
  google.protobuf.Timestamp create_time = 5;
  // Output only. The time at which the configuration was last changed.
  //
  // This value is initially set to the `create_time` then increases monotonically with each change.
  google.protobuf.Timestamp update_time = 6;
  // Output only. The time this configuration was destroyed.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp destroy_time = 7;
  // Output only. The time this configuration will be entirely deleted.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp delete_time = 8;
  // Output only. Multiversion concurrency control version.
  string etag = 9;
  // CustomerId this object is directly or indirectly connected to.
  string customer_id = 10 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // AppSpaceId this object is directly or indirectly connected to.
  string app_space_id = 11 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // ApplicationId this object is directly connected to.
  string application_id = 12 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
}

message ApplicationAgentCredential {
  // Globally unique identifier.
  string id = 1 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // Kid is public key ID
  string kid = 2 [(validate.rules).string = {
    min_len: 41,
    max_len: 45,
    pattern: "^[a-zA-Z0-9-_]+$",
  }];
  // Human readable name of configuration.
  string display_name = 3 [(validate.rules).string = {min_len: 2, max_len: 254}];

  // Output only. The time at which the configuration was created.
  google.protobuf.Timestamp create_time = 5;
  // Output only. The time this configuration was destroyed.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp destroy_time = 7;
  // Output only. The time this configuration will be entirely deleted.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp delete_time = 8;

  // CustomerId this object is directly or indirectly connected to.
  string customer_id = 10 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // AppSpaceId this object is directly or indirectly connected to.
  string app_space_id = 11 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // ApplicationId this object is directly connected to.
  string application_id = 12 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // ApplicationAgentId this object is directly connected to.
  string application_agent_id = 9 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
}

message ConfigNode {
  // Globally unique identifier.
  string id = 1 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // Name is unique name of configuration object.
  string name = 2 [(validate.rules).string = {
    min_len: 2,
    max_len: 254
    pattern: "^[a-z](?:[-a-z0-9]{0,252}[a-z0-9])$"
  }];
  // Human readable name of configuration.
  string display_name = 3 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Description of the configuration
  google.protobuf.StringValue description = 4 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Output only. The time at which the configuration was created.
  google.protobuf.Timestamp create_time = 5;
  // Output only. The time at which the configuration was last changed.
  //
  // This value is initially set to the `create_time` then increases monotonically with each change.
  google.protobuf.Timestamp update_time = 6;
  // Output only. The time this configuration was destroyed.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp destroy_time = 7;
  // Output only. The time this configuration will be entirely deleted.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp delete_time = 8;
  // Output only. Multiversion concurrency control version.
  string etag = 9;
  // CustomerId this object is directly or indirectly connected to.
  string customer_id = 10 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // AppSpaceId this object is directly or indirectly connected to.
  string app_space_id = 11 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // TenantId this object is directly or indirectly connected to.
  string tenant_id = 12 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];

  oneof config {
    option (validate.required) = true;
    AuthFlowConfig auth_flow_config = 14;
    EmailServiceConfig email_service_config = 15;

    // OAuth2ClientConfig for third party OIDC clients.
    OAuth2ClientConfig oauth2_client_config = 16;

    PasswordProviderConfig password_provider_config = 18;
    WebAuthnProviderConfig webauthn_provider_config = 19;
    AuthenteqProviderConfig authenteq_provider_config = 20;
    SAFRProviderConfig safr_provider_config = 21;
  }
}

//
//
// OAuth2 Configurations
//
//

//ProviderType is a list of supported OAuth2 providers.
enum ProviderType {
  PROVIDER_TYPE_INVALID = 0;
  PROVIDER_TYPE_AMAZON_COM = 1;
  PROVIDER_TYPE_AMAZONCOGNITO_COM = 34;
  PROVIDER_TYPE_BITBUCKET = 2;
  PROVIDER_TYPE_CERN_CH = 3;
  PROVIDER_TYPE_FACEBOOK_COM = 4;
  PROVIDER_TYPE_FITBIT_COM = 5;
  PROVIDER_TYPE_FOURSQUARE_COM = 6;
  PROVIDER_TYPE_GITHUB_COM = 7;
  PROVIDER_TYPE_GITLAB_COM = 8;
  PROVIDER_TYPE_GOOGLE_COM = 9;
  PROVIDER_TYPE_HEROKU_COM = 10;
  PROVIDER_TYPE_HIPCHAT_COM = 11;
  PROVIDER_TYPE_INSTAGRAM_COM = 12;
  PROVIDER_TYPE_KAKAO_COM = 13;
  PROVIDER_TYPE_LINKEDIN_COM = 14;
  PROVIDER_TYPE_MAILCHIMP_COM = 15;
  PROVIDER_TYPE_MAIL_RU = 16;
  PROVIDER_TYPE_MEDIAMATH_COM = 17;
  PROVIDER_TYPE_SANDBOX_MEDIAMATH_COM = 18;
  PROVIDER_TYPE_LIVE_COM = 32;
  PROVIDER_TYPE_MICROSOFT_COM = 19;
  PROVIDER_TYPE_HEALTH_NOKIA_COM = 20;
  PROVIDER_TYPE_ODNOKLASSNIKI_RU = 21;
  PROVIDER_TYPE_PAYPAL_COM = 22;
  PROVIDER_TYPE_SANDBOX_PAYPAL_COM = 23;
  PROVIDER_TYPE_SLACK_COM = 24;
  PROVIDER_TYPE_SPOTIFY_COM = 25;
  PROVIDER_TYPE_STACKOVERFLOW_COM = 26;
  PROVIDER_TYPE_TWITCH_TV = 27;
  PROVIDER_TYPE_UBER_COM = 28;
  PROVIDER_TYPE_VK_COM = 29;
  PROVIDER_TYPE_YAHOO_COM = 30;
  PROVIDER_TYPE_YANDEX_COM = 31;
  PROVIDER_TYPE_AUTHENTEQ_COM = 33;
  PROVIDER_TYPE_INDYKITE_ID = 35;
  PROVIDER_TYPE_INDYKITE_ME = 36;
  PROVIDER_TYPE_CUSTOM = 39;
}

// OAuth2ClientConfig is a service specific set of parameters
message OAuth2ClientConfig {
  ProviderType provider_type = 1 [(validate.rules).enum = {
    defined_only: true
    not_in: [0]
  }];
  string client_id = 2 [(validate.rules).string = {
    min_len: 8
  }];
  string client_secret = 3 [(validate.rules).string = {
    min_len: 8
  }];
  repeated string redirect_uri = 4 [(validate.rules).repeated = {
    ignore_empty: true,
    unique: true,
  }, (validate.rules).repeated.items.string = {
    min_len: 8
    uri: true
  }];
  repeated string default_scopes = 17  [(validate.rules).repeated = {
    unique: true,
    ignore_empty: true,
  }, (validate.rules).repeated.items.string = {
    min_len: 1
  }];
  repeated string allowed_scopes = 19 [(validate.rules).repeated = {
    unique: true,
    ignore_empty: true,
  }, (validate.rules).repeated.items.string = {
    min_len: 1
  }];
  //string loginHint = 5;

  //  string code_challenge_method = 6 [(validate.rules).string = {ignore_empty: true, in: ["plain", "S256"]}];
  bool allow_signup = 8; //": "true This is only Github so maybe logic for UI as a hint?",
  // URL using the https scheme with no query or fragment component that the OP asserts as its Issuer Identifier.
  // If Issuer discovery is supported (see Section 2), this value MUST be identical to the issuer value returned by WebFinger.
  // This also MUST be identical to the iss Claim value in ID Tokens issued from this Issuer.
  // Example: `https://server/issuer/.well-known/openid-configuration`
  string issuer = 9 [(validate.rules).string = {
    min_len: 9
    uri: true
    prefix: "https"
    ignore_empty: true
  }];
  // URL of the OP's OAuth 2.0 Authorization Endpoint
  // Example: `https://server/issuer/.well-known/openid-configuration`
  string authorization_endpoint = 10 [(validate.rules).string = {
    min_len: 9
    uri: true
    prefix: "https"
    ignore_empty: true
  }];
  // RL of the OP's OAuth 2.0 Token Endpoint
  string token_endpoint = 11 [(validate.rules).string = {
    min_len: 9
    uri: true
    prefix: "https"
    ignore_empty: true
  }];
  string discovery_url = 16 [(validate.rules).string = {
    min_len: 9
    uri: true
    prefix: "https"
    ignore_empty: true
  }];
  //URL of the OP's UserInfo Endpoint
  // Example `https://server/issuer/.well-known/openid-configuration`
  string userinfo_endpoint = 12 [(validate.rules).string = {
    min_len: 9
    uri: true
    prefix: "https"
    ignore_empty: true
  }];
  // URL of the OP's JSON Web Key Set [JWK] document. This contains the signing key(s) the
  // RP uses to validate signatures from the OP. The JWK Set MAY also contain the Server's encryption key(s),
  // which are used by RPs to encrypt requests to the Server. When both signing and encryption keys are made available,
  // a use (Key Use) parameter value is REQUIRED for all keys in the referenced JWK Set to indicate each key's
  // intended usage. Although some algorithms allow the same key to be used for both signatures and encryption,
  // doing so is NOT RECOMMENDED, as it is less secure. The JWK x5c parameter MAY be used to provide X.509
  // representations of keys provided. When used, the bare key values MUST still be present and MUST match those in the certificate.
  string jwks_uri = 13 [(validate.rules).string = {
    min_len: 9
    uri: true
    prefix: "https"
    ignore_empty: true
  }];
  // Example `https://server/openid.png`
  string image_url = 14 [(validate.rules).string = {
    min_len: 2
    max_len: 1024
    ignore_empty: true
  }];
  // Example `login.microsoftonline.com/" + tenant + "/oauth2/v2.0/authorize`
  string tenant = 15 [(validate.rules).string = {
    min_len: 2
    max_len: 254
    ignore_empty: true
  }];
  // [Send Auth Request](https://developers.google.com/identity/protocols/oauth2/openid-connect#sendauthrequest)
  // [Authentication URI Parameters](https://developers.google.com/identity/protocols/oauth2/openid-connect#authenticationuriparameters)
  string hosted_domains = 18 [(validate.rules).string = {
    min_len: 2
    max_len: 254
    ignore_empty: true
    hostname: true
  }];
}

//
//
//  OAuth2/OIDC Service Configuration
//
//

enum GrantType {
  GRANT_TYPE_INVALID = 0;
  // https://tools.ietf.org/html/rfc6749#section-4.1
  GRANT_TYPE_AUTHORIZATION_CODE = 1;
  // https://tools.ietf.org/html/rfc6749#section-4.2
  GRANT_TYPE_IMPLICIT = 2;
  // https://tools.ietf.org/html/rfc6749#section-4.3
  GRANT_TYPE_PASSWORD = 3;
  // https://tools.ietf.org/html/rfc6749#section-4.4
  GRANT_TYPE_CLIENT_CREDENTIALS = 4;
  // https://tools.ietf.org/html/rfc6749#section-6
  GRANT_TYPE_REFRESH_TOKEN = 5;
}

enum ResponseType {
  RESPONSE_TYPE_INVALID = 0;
  RESPONSE_TYPE_TOKEN = 1;
  RESPONSE_TYPE_CODE = 2;
  RESPONSE_TYPE_ID_TOKEN = 3;
}

enum ClientSubjectType {
  CLIENT_SUBJECT_TYPE_INVALID = 0;
  CLIENT_SUBJECT_TYPE_PUBLIC = 1;
  CLIENT_SUBJECT_TYPE_PAIRWISE = 2;
}

enum TokenEndpointAuthMethod {
  TOKEN_ENDPOINT_AUTH_METHOD_INVALID = 0;
  TOKEN_ENDPOINT_AUTH_METHOD_CLIENT_SECRET_BASIC = 1;
  TOKEN_ENDPOINT_AUTH_METHOD_CLIENT_SECRET_POST = 2;
  TOKEN_ENDPOINT_AUTH_METHOD_PRIVATE_KEY_JWT = 3;
  TOKEN_ENDPOINT_AUTH_METHOD_NONE = 4;
}

message OAuth2Application {
  // Globally unique identifier.
  string id = 1 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // Name is unique name of configuration object.
  string name = 2 [(validate.rules).string = {
    min_len: 2,
    max_len: 254
    pattern: "^[a-z](?:[-a-z0-9]{0,252}[a-z0-9])$"
  }];
  // Human readable name of configuration.
  string display_name = 3 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Description of the configuration
  google.protobuf.StringValue description = 4 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Output only. The time at which the configuration was created.
  google.protobuf.Timestamp create_time = 5;
  // Output only. The time at which the configuration was last changed.
  //
  // This value is initially set to the `create_time` then increases monotonically with each change.
  google.protobuf.Timestamp update_time = 6;
  // Output only. The time this configuration was destroyed.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp destroy_time = 7;
  // Output only. The time this configuration will be entirely deleted.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp delete_time = 8;
  // Output only. Multiversion concurrency control version.
  string etag = 9;
  // CustomerId this object is indirectly connected to.
  string customer_id = 10 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // AppSpaceId this object is indirectly connected to.
  string app_space_id = 11 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // oauth2_provider_id this object is directly connected to.
  string oauth2_provider_id = 12 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];

  // OAuth2ApplicationConfig IndyKite OIDC Application Config
  OAuth2ApplicationConfig config = 13;
}

message OAuth2ApplicationConfig {
  // ClientId is the id for this client.
  // It is read-only and is ignored during create/update request.
  string client_id = 1;

  // DisplayName is a human readable name to show in consent page etc, not in Console
  string display_name = 3  [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Description is a optional description to show in consent page etc, not in Console
  string description = 4  [(validate.rules).string = {ignore_empty: true, min_len: 2, max_len: 254}];

  // RedirectURIs is an array of allowed redirect urls for the client, for example http://mydomain/oauth/callback .
  repeated string redirect_uris = 5 [(validate.rules).repeated = {
    min_items: 1,
    unique: true,
    items: {string: {uri: true}}
  }];

  // Owner is a string identifying the owner of the OAuth 2.0 Client.
  string owner = 6 [(validate.rules).string = {min_len: 2, max_len: 254}];

  // PolicyURI is a URL string that points to a human-readable privacy policy document
  // that describes how the deployment organization collects, uses,
  // retains, and discloses personal data.
  string policy_uri = 7 [(validate.rules).string = {uri: true, max_len: 254}];

  // AllowedCORSOrigins are one or more URLs (scheme://host[:port]) which are allowed to make CORS requests
  // to the /oauth/token endpoint. If this array is empty, the sever's CORS origin configuration (`CORS_ALLOWED_ORIGINS`)
  // will be used instead. If this array is set, the allowed origins are appended to the server's CORS origin configuration.
  // Be aware that environment variable `CORS_ENABLED` MUST be set to `true` for this to work.
  repeated string allowed_cors_origins = 8  [(validate.rules).repeated = {
    unique: true,
    items: {string: {uri: true, max_len: 254}}
  }];

  // TermsOfServiceURI is a URL string that points to a human-readable terms of service
  // document for the client that describes a contractual relationship
  // between the end-user and the client that the end-user accepts when
  // authorizing the client.
  string terms_of_service_uri = 9 [(validate.rules).string = {uri: true, max_len: 254}];

  // ClientURI is an URL string of a web page providing information about the client.
  // If present, the server SHOULD display this URL to the end-user in
  // a clickable fashion.
  string client_uri = 10 [(validate.rules).string = {uri: true, max_len: 254}];

  // LogoURI is an URL string that references a logo for the client.
  string logo_uri = 11 [(validate.rules).string = {uri: true, max_len: 254}];

  // UserSupportEmailAddress is main email contact for User support
  string user_support_email_address = 12 [(validate.rules).string = {email: true, max_len: 254}];

  // AdditionalContacts is a array of strings representing ways to contact people responsible
  // for this client, typically email addresses.
  repeated string additional_contacts = 13;

  // SecretExpiresAt is an integer holding the time at which the client
  // secret will expire or 0 if it will not expire. The time is
  // represented as the number of seconds from 1970-01-01T00:00:00Z as
  // measured in UTC until the date/time of expiration.
  //
  // This feature is currently not supported and it's value will always
  // be set to 0.
  //SecretExpiresAt int `json:"client_secret_expires_at" db:"client_secret_expires_at"`

  // SubjectType requested for responses to this Client. The subject_types_supported Discovery parameter contains a
  // list of the supported subject_type values for this server. Valid types include `pairwise` and `public`.
  ClientSubjectType subject_type = 14 [(validate.rules).enum = {
    defined_only: true,
    not_in: [0],
  }];

  // URL using the https scheme to be used in calculating Pseudonymous Identifiers by the OP. The URL references a
  // file with a single JSON array of redirect_uri values.
  string sector_identifier_uri = 15 [(validate.rules).string = {uri: true, ignore_empty: true, max_len: 254}];

  // GrantTypes is an array of grant types the client is allowed to use.
  //
  // Pattern: client_credentials|authorization_code|implicit|refresh_token
  repeated  GrantType grant_types = 16 [(validate.rules).repeated = {
    unique: true,
    items: {enum: {
      defined_only: true,
      not_in: [0],
    }}
  }];

  // ResponseTypes is an array of the OAuth 2.0 response type strings that the client can
  // use at the authorization endpoint.
  //
  // Pattern: id_token|code|token
  repeated ResponseType response_types = 17 [(validate.rules).repeated = {
    unique: true,
    items: {enum: {
      defined_only: true,
      not_in: [0],
    }}
  }];

  // Scope is a string containing a space-separated list of scope values (as
  // described in Section 3.3 of OAuth 2.0 [RFC6749]) that the client
  // can use when requesting access tokens.
  //
  // Pattern: ^[!#-\[\]-~]{1,254}$
  repeated string scopes = 18 [(validate.rules).repeated = {
    unique: true,
    min_items: 1,
    items: {string: {pattern: "^[\\x21\\x23-\\x5b\\x5d-\\x7e]{1,254}$"}}
  }];

  // Audience is a whitelist defining the audiences this client is allowed to request tokens for. An audience limits
  // the applicability of an OAuth 2.0 Access Token to, for example, certain API endpoints.
  repeated string audiences = 19 [(validate.rules).repeated = {
    unique: true,
    items: {string: {uuid: true}}
  }];

  // Requested Client Authentication method for the Token Endpoint. The options are client_secret_post,
  // client_secret_basic, private_key_jwt, and none.
  TokenEndpointAuthMethod token_endpoint_auth_method = 20 [(validate.rules).enum = {
    defined_only: true,
    not_in: [0],
  }];

  // Requested Client Authentication signing algorithm for the Token Endpoint.
  string token_endpoint_auth_signing_alg = 21  [(validate.rules).string = {in: [
    "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256",
    "ES384", "ES512", "ES256K", "HS256", "HS384", "HS512", "EdDSA"
  ]
  }];

  // JWS alg algorithm [JWA] REQUIRED for signing UserInfo Responses. If this is specified, the response will be JWT
  // [JWT] serialized, and signed using JWS. The default, if omitted, is for the UserInfo Response to return the Claims
  // as a UTF-8 encoded JSON object using the application/json content-type.
  string userinfo_signed_response_alg = 22[(validate.rules).string = {ignore_empty: true, in: ["RS256"]}];
}

message OAuth2Provider {
  // Globally unique identifier.
  string id = 1 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // Name is unique name of configuration object.
  string name = 2 [(validate.rules).string = {
    min_len: 2,
    max_len: 254
    pattern: "^[a-z](?:[-a-z0-9]{0,252}[a-z0-9])$"
  }];
  // Human readable name of configuration.
  string display_name = 3 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Description of the configuration
  google.protobuf.StringValue description = 4 [(validate.rules).string = {min_len: 2, max_len: 254}];
  // Output only. The time at which the configuration was created.
  google.protobuf.Timestamp create_time = 5;
  // Output only. The time at which the configuration was last changed.
  //
  // This value is initially set to the `create_time` then increases monotonically with each change.
  google.protobuf.Timestamp update_time = 6;
  // Output only. The time this configuration was destroyed.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp destroy_time = 7;
  // Output only. The time this configuration will be entirely deleted.
  //
  // Only present if deletion of object was requested.
  google.protobuf.Timestamp delete_time = 8;
  // Output only. Multiversion concurrency control version.
  string etag = 9;
  // CustomerId this object is indirectly connected to.
  string customer_id = 10 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];
  // AppSpaceId this object is indirectly connected to.
  string app_space_id = 11 [(validate.rules).string = {
    min_len: 22
    max_len: 254
    pattern: "^[A-Za-z0-9-_:]{22,254}$"
  }];

  // OAuth2ApplicationConfig IndyKite OIDC Application Config
  OAuth2ProviderConfig config = 12;
}

message OAuth2ProviderConfig {
  // GrantTypes is an array of grant types the client is allowed to use.
  //
  // Pattern: client_credentials|authorization_code|implicit|refresh_token
  repeated  GrantType grant_types = 1  [(validate.rules).repeated = {
    min_items: 1,
    unique: true,
    items: {enum: {
      defined_only: true,
      not_in: [0],
    }}
  }];

  // ResponseTypes is an array of the OAuth 2.0 response type strings that the client can
  // use at the authorization endpoint.
  //
  // Pattern: id_token|code|token
  repeated ResponseType response_types = 2 [(validate.rules).repeated = {
    min_items: 1,
    unique: true,
    items: {enum: {
      defined_only: true,
      not_in: [0],
    }}
  }];

  // Scope is a string containing a space-separated list of scope values (as
  // described in Section 3.3 of OAuth 2.0 [RFC6749]) that the client
  // can use when requesting access tokens.
  //
  // Pattern: ^[!#-\[\]-~]{1,254}$
  repeated string scopes = 3 [(validate.rules).repeated = {
    unique: true,
    min_items: 1,
    items: {string: {pattern: "^[\\x21\\x23-\\x5b\\x5d-\\x7e]{1,254}$"}}
  }];

  // Client's JSON Web Key Set [JWK] document, passed by value. The semantics of the jwks parameter are the same as
  // the jwks_uri parameter, other than that the JWK Set is passed by value, rather than by reference. This parameter
  // is intended only to be used by Clients that, for some reason, are unable to use the jwks_uri parameter, for
  // instance, by native applications that might not have a location to host the contents of the JWK Set. If a Client
  // can use jwks_uri, it MUST NOT use jwks. One significant downside of jwks is that it does not enable key rotation
  // (which jwks_uri does, as described in Section 10 of OpenID Connect Core 1.0 [OpenID.Core]). The jwks_uri and jwks
  // parameters MUST NOT be used together.
  //JSONWebKeys *x.JoseJSONWebKeySet `json:"jwks,omitempty" db:"jwks"`

  // Requested Client Authentication method for the Token Endpoint. The options are client_secret_post,
  // client_secret_basic, private_key_jwt, and none.
  repeated TokenEndpointAuthMethod token_endpoint_auth_method = 4 [(validate.rules).repeated = {
    min_items: 1,
    items: {enum: {defined_only: true, not_in: [0]}}
  }];

  // Requested Client Authentication signing algorithm for the Token Endpoint.
  repeated string token_endpoint_auth_signing_alg = 5  [(validate.rules).repeated = {
    min_items: 1,
    items: {string: {in: ["RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512", "ES256K", "HS256", "HS384", "HS512", "EdDSA"]}}
  }];

  // Array of request_uri values that are pre-registered by the RP for use at the OP. Servers MAY cache the
  // contents of the files referenced by these URIs and not retrieve them at the time they are used in a request.
  // OPs can require that request_uri values used be pre-registered with the require_request_uri_registration
  // discovery parameter.
  repeated string request_uris = 6 [(validate.rules).repeated = {
    items: {string: {uri: true}}
  }];

  // RequestObjectSigningAlg JWS [JWS] alg algorithm [JWA] that MUST be used for signing Request Objects sent to the OP. All Request Objects
  // from this Client MUST be rejected, if not signed with this algorithm.
  string request_object_signing_alg = 7 [(validate.rules).string = {
    ignore_empty: true,
    in: ["RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512", "ES256K", "HS256", "HS384", "HS512", "EdDSA"],
  }];

  map<string, string>  front_channel_login_uri = 8 [(validate.rules).map = {
    min_pairs: 1,
    keys: {string: {
      max_len: 32,
    }},
    values: {string: {
      uri : true,
    }}
  }];

  map<string, string>  front_channel_consent_uri = 9 [(validate.rules).map = {
    min_pairs: 1,
    keys: {string: {
      max_len: 32,
    }},
    values: {string: {
      uri : true,
    }}
  }];

  // RP URL that will cause the RP to log itself out when rendered in an iframe by the OP. An iss (issuer) query
  // parameter and a sid (session ID) query parameter MAY be included by the OP to enable the RP to validate the
  // request and to determine which of the potentially multiple sessions is to be logged out; if either is
  // included, both MUST be.
  //FrontChannelLogoutURI string `json:"frontchannel_logout_uri,omitempty" db:"frontchannel_logout_uri"`

  // Boolean value specifying whether the RP requires that iss (issuer) and sid (session ID) query parameters be
  // included to identify the RP session with the OP when the frontchannel_logout_uri is used.
  // If omitted, the default value is false.
  //FrontChannelLogoutSessionRequired bool `json:"frontchannel_logout_session_required,omitempty" db:"frontchannel_logout_session_required"`

  // Array of URLs supplied by the RP to which it MAY request that the End-User's User Agent be redirected using the
  // post_logout_redirect_uri parameter after a logout has been performed.
  //PostLogoutRedirectURIs []string `json:"post_logout_redirect_uris,omitempty" db:"post_logout_redirect_uris"`

  // RP URL that will cause the RP to log itself out when sent a Logout Token by the OP.
  //BackChannelLogoutURI string `json:"backchannel_logout_uri,omitempty" db:"backchannel_logout_uri"`

  // Boolean value specifying whether the RP requires that a sid (session ID) Claim be included in the Logout
  // Token to identify the RP session with the OP when the backchannel_logout_uri is used.
  // If omitted, the default value is false.
  //BackChannelLogoutSessionRequired bool `json:"backchannel_logout_session_required,omitempty" db:"backchannel_logout_session_required"`

  // Metadata is arbitrary data.
  //Metadata sqlxx.JSONRawMessage `json:"metadata,omitempty" db:"metadata"`
}

//
//
// WebAuthn Configuration
//
//

//ConveyancePreference ...
enum ConveyancePreference {
  CONVEYANCE_PREFERENCE_INVALID = 0;
  CONVEYANCE_PREFERENCE_NONE = 1;
  CONVEYANCE_PREFERENCE_INDIRECT = 2;
  CONVEYANCE_PREFERENCE_DIRECT = 3;
}

//AuthenticatorAttachment ...
enum AuthenticatorAttachment {
  AUTHENTICATOR_ATTACHMENT_INVALID = 0;
  AUTHENTICATOR_ATTACHMENT_DEFAULT = 1;
  AUTHENTICATOR_ATTACHMENT_PLATFORM = 2;
  AUTHENTICATOR_ATTACHMENT_CROSS_PLATFORM = 3;
}

//UserVerificationRequirement ...
enum UserVerificationRequirement {
  USER_VERIFICATION_REQUIREMENT_INVALID = 0;
  USER_VERIFICATION_REQUIREMENT_PREFERRED = 1;
  USER_VERIFICATION_REQUIREMENT_REQUIRED = 2;
  USER_VERIFICATION_REQUIREMENT_DISCOURAGED = 3;
}

//WebAuthnProviderConfig ...
message WebAuthnProviderConfig {
  string id = 1;
  //Could be Shared between multiple sites? WebAuthnSiteDefinition
  string display_name = 2;
  string origin = 3;
  string icon = 4;
  //
  ConveyancePreference attestation_preference = 5;
  AuthenticatorAttachment authenticator_attachment = 6;
  bool require_resident_key = 7;
  UserVerificationRequirement user_verification = 8;
  //
  uint32 registration_timeout = 9;
  uint32 authentication_timeout = 11;

  bool debug = 10;
}

//WebAuthnSiteDefinition ...
message WebAuthnSiteDefinition {
  string id = 1;
  string display_name = 2;
  string origin = 3;
  string icon = 4;
}

// AuthFlowConfig Flow Definition
message AuthFlowConfig {
  enum Format {
    FORMAT_BARE_INVALID = 0;
    FORMAT_BARE_YAML = 1;
    FORMAT_BARE_JSON = 2;
    FORMAT_RICH_JSON = 3;
  }

  Format source_format = 1  [(validate.rules).enum = {
    defined_only: true,
  }];
  // JSON from Console UI of the Flow diagram
  bytes source = 2 [(validate.rules).bytes = {
    max_len : 1048576 // 1Mb
  }];

  google.protobuf.BoolValue default = 3;

  // Proto soon to deprecate once the rich_json can be parsed and compiled.
  google.protobuf.Any proto = 4 [(validate.rules).any = {
    in: ["type.googleapis.com/id.indykite.jarvis.flow.FlowDescription",
      "type.googleapis.com/indykite.flow.v1beta1.FlowDescription"]}
  ];
}

//
// Authenteq Configuration
//

// AuthenteqProviderConfig ...
message AuthenteqProviderConfig {
  //DefaultRedirectUri used when RedirectUri selection is not obvious.
  string default_redirect_uri = 1;
  string client_id = 2 [(validate.rules).string = {
    min_len: 12
  }];
  string client_secret = 3 [(validate.rules).string = {
    min_len: 12
  }];
  string host_address = 4 [(validate.rules).string = {
    hostname: true
  }];
}

//
// RealNetworks SAFR Configuration
//

// SAFRProviderConfig ...
message SAFRProviderConfig {
  string account_id = 1 [(validate.rules).string = {
    min_len: 2
    max_len: 254
  }];
  string password = 2 [(validate.rules).string = {
    min_len: 4
    max_len: 254
  }];
  // Directory ...
  // Default value : main
  string directory = 3 [(validate.rules).string = {
    min_len: 2
    max_len: 254
  }];
}

//
// SMS Notification Service Configuration
//

// SMSServiceConfig ...
message SMSServiceConfig {

}

//
// Email Notification Service Configuration
//

// EmailServiceConfig ...
message EmailServiceConfig {
  Email default_from_address = 1;
  google.protobuf.BoolValue default = 3;
  oneof provider {
    SendGridProviderConfig sendgrid = 4 [(validate.rules).message = {required: true}];
    MailJetProviderConfig mailjet = 5 [(validate.rules).message = {required: true}];
    MailgunProviderConfig mailgun = 6 [(validate.rules).message = {required: true}];
    AmazonSESProviderConfig amazon = 7 [(validate.rules).message = {required: true}];
  }

  EmailDefinition authentication_message = 12;
  EmailDefinition invitation_message = 9;
  EmailDefinition reset_password_message = 10;
  EmailDefinition verification_message = 11;
}

// Email holds email name and address info.
message Email {
  string address = 1 [(validate.rules).string = {
    email: true
    max_len: 254
  }];
  string name = 2 [(validate.rules).string = {
    ignore_empty: true
    min_len: 1
    //https://tools.ietf.org/html/rfc5321#section-4.5.3.1.4
    // `a <b@c><CRLF>`
    max_len: 503
  }];
}

message SendGridProviderConfig {
  string api_key = 1 [(validate.rules).string = {
    min_len: 25
    max_len: 254
  }];
  bool sandbox_mode = 2;
  google.protobuf.StringValue ip_pool_name = 3 [(validate.rules).string = {
    ignore_empty: true
    min_len: 2
    max_len: 64
  }];
  // Host default to https://api.sendgrid.com
  google.protobuf.StringValue host = 4 [(validate.rules).string = {
    ignore_empty: true
    min_len: 10
    max_len: 254
    uri: true
  }];
}

message MailJetProviderConfig {
  string api_key = 1 [(validate.rules).string = {
    min_len: 25
    max_len: 254
  }];
  bool sandbox_mode = 2;
  map<string, string> url_tags = 8;
  google.protobuf.StringValue custom_campaign = 4;
}

message MailgunProviderConfig {
  string api_key = 1[(validate.rules).string = {
    min_len: 25
    max_len: 254
  }];
  Email default_from_address = 2;
}

message AmazonSESProviderConfig {

  // AWS Access key ID
  string access_key_id = 1[(validate.rules).string = {
    min_len: 25
    max_len: 254
  }];

  // AWS Secret Access Key
  string secret_access_key = 2[(validate.rules).string = {
    min_len: 25
    max_len: 254
  }];

  // The region to send requests to. This parameter is required and must
  // be configured globally or on a per-client basis unless otherwise
  // noted. A full list of regions is found in the "Regions and Endpoints"
  // document.
  //
  // See (Regions)[http://docs.aws.amazon.com/general/latest/gr/rande.html] for AWS
  // Regions and Endpoints.
  string   region = 4 [(validate.rules).string = {
    min_len: 2
    max_len: 20
  }];

  // ConfigurationSetName The name of the configuration set that you want to use when sending the email.
  string configuration_set_name = 5 [(validate.rules).string = {
    ignore_empty: true
    max_len: 254
  }];
  Email default_from_address = 6;
  // FeedbackForwardingEmailAddress The address that you want bounce and complaint notifications to be sent to.
  string  feedback_forwarding_email_address = 7 [(validate.rules).string = {
    ignore_empty: true
    email: true
    max_len: 503
  }];

  // ReplyToAddresses The "Reply-to" email addresses for the message.
  //
  // When the recipient replies  to the message, each Reply-to address receives the reply.
  repeated string  reply_to_addresses = 8 [(validate.rules).repeated.items.string = {
    email: true
    max_len: 503
  }];
}

message EmailDefinition {
  oneof email {
    EmailTemplate template = 2 [(validate.rules).message = {required: true}];
    EmailMessage  message = 3 [(validate.rules).message = {required: true}];
  }
}

//TODO Support
// https://documentation.mailgun.com/en/latest/api-sending.html#sending
// https://dev.mailjet.com/email/guides/send-api-v31/
// https://sendgrid.com/docs/api-reference/

message EmailTemplate {
  string template_id = 1  [(validate.rules).string = {
    min_len: 1
    max_len: 254
  }];
  google.protobuf.StringValue template_version = 20 [(validate.rules).string = {
    min_len: 1
    max_len: 254
  }];
  Email from = 2;
  Email reply_to = 3;
  repeated Email to = 4;
  repeated Email cc = 5;
  repeated Email bcc = 6;
  string subject = 7 [(validate.rules).string = {
    ignore_empty: true
    min_len: 1
    max_len: 503
  }];
  map<string, string> headers = 8;
  map<string, string> custom_args = 11;
  map<string, indykite.objects.v1beta1.Value> dynamic_template_values = 12;
  repeated string categories = 13;
  repeated EmailAttachment attachments = 14;
  google.protobuf.StringValue event_payload = 15;
  // The Amazon Resource Name (ARN) of the template.
  string  template_arn = 16;
}

message EmailAttachment {
  string content_type = 1;
  google.protobuf.StringValue content_id = 2;
  bool inline = 3;
  string file_name = 4;
  bytes content = 5;
}

message EmailMessage {
  Email from = 1;
  Email reply_to = 2;
  repeated Email to = 3;
  repeated Email cc = 4;
  repeated Email bcc = 5;
  string subject = 6 [(validate.rules).string = {
    ignore_empty: true
    min_len: 1
    max_len: 503
  }];

  string text_content = 7;
  string html_content = 8;

  map<string, string> headers = 9;
  map<string, string> custom_args = 11;
  map<string, indykite.objects.v1beta1.Value> dynamic_template_values = 10;
  repeated string categories = 12;
  repeated EmailAttachment attachments = 13;
  google.protobuf.StringValue event_payload = 14;
}

//
// Password Provider Service Configuration
//

// PasswordProviderConfig ...
message PasswordProviderConfig {
  UsernamePolicy username_policy = 1 [(validate.rules).message.required = true];
  PasswordPolicy password_policy = 2 [(validate.rules).message.required = true];
  //Specifies the period (in seconds) after which the failure count will be reset.
  google.protobuf.Duration fail_interval = 3;
  google.protobuf.Duration minimum_password_lifetime = 4;
  google.protobuf.Duration maximum_password_lifetime = 5;
  //Sets the number of previous passwords that are stored and which a user is prevented from using
  int64 password_history = 6;
  //Specifies the maximum number of consecutive failures to input the correct password before the user's account is locked.
  int64 maximum_consecutive_failures = 7;
  //Specifies the period (in seconds) for which a lockout is enforced.
  google.protobuf.Duration lockout_time = 8;
}

message UsernamePolicy {
  // Must be valid email with MX record
  bool valid_email = 1;
  // Email must be verified
  bool verify_email = 2;

  // Allowed email domains to register. Can be shared among tenants.
  repeated string allowed_email_domains = 3;

  // Unique email domain in AppSpace, not allowed to be shared amon tenants.
  repeated string exclusive_email_domains = 4;
}

enum PasswordPolicyTemplate {
  PASSWORD_POLICY_TEMPLATE_INVALID = 0;
  PASSWORD_POLICY_TEMPLATE_CUSTOM = 1;
  PASSWORD_POLICY_TEMPLATE_NIST = 2;
}

message PasswordPolicy {
  PasswordPolicyTemplate template = 1;
  google.protobuf.Int64Value minimum_length = 2;
}
